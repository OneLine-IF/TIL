## 소켓 사용하기
### 소켓 사용하기
- 데이터를 보내줄 서버의 기능과 데이터를 보내달라고 하는 클라이언트 기능을 구성할 수 있음
- 이런 기능을 네트워킹이라고 부르는 기능임, 인터넷을 사용할 때 네트워킹을 사용함

- 네트워킹이란?
- 원격지의 서버를 연결하는 방식
- 데이터를 주고 받을 때 데이터를 보내줄 수 있는 기능은 서버임, 데이터를 어떤 걸 보내다라고 요청하는데 그것을 클라이언트라고 함
- 클라이언트가 요청을 하고 서버가 응답하는 것이 기본적인 네트워킹 모델임
- 2-tier C/S 모델
	- 클라이언트와 서버가 일대일로 연결하는 방식
<img src="https://user-images.githubusercontent.com/32586985/91122349-1308fc80-e6d5-11ea-86c1-c50a66d5cdcf.PNG">

- 3-tier 모델
	- 서버를 좀 더 유연하게 구성
	- 응용 서버와 데이터 서버로 구성하는 경우, 데이터베이스를 분리시킴
	- 중간에 서버를 애플리케이션 서버 또는 미드 웨어라고도 함
<img src="https://user-images.githubusercontent.com/32586985/91122373-25833600-e6d5-11ea-89fb-ee675ad33f0a.PNG">

- 네트워킹에 대한 이해
	- TCP/IP 수준의 통신 방식을 제공하는 소켓을 이용해 서버에 연결해 보면 이해하기 쉬움
	- 일반적인 프로그래밍에서는 대부분 TCP 연결 사용
	- 비연결성(stateless) 특성으로 인해 실시간으로 데이터를 처리하는 애플리케이션의 경우, 응답 속도를 높이기 위해 HTTP보다 소켓 연결 선호
- 소켓 연결 방식
	- 안드로이드에서는 표준 자바의 소켓을 그대로 사용할 수 있음
	- 서버쪽에는 서버소켓을 만들어 실행함(포트 지정)
	- 클라이언트쪽에서는 소켓을 만들어 서버 소켓으로 연결함 (IP와 포트 지정)
	- Stream 객체를 이용해 데이터를 보내거나 받을 수 있음

- 네트워킹 사용 시 주의할 점
- 네트워킹을 사용할 때는 반드시 스레드 사용
	- 최신 버전의 안드로이드에서는 네트워킹을 사용할 때는 반드시 스레드를 사용하도록 변경되었음
- 스레드를 사용하므로 UI 업데이트를 위해서는 반드시 핸들러 사용
	- 네트워킹을 위해 새로 만든 스레드 안에서 그 결과를 보여주기 위해 UI 업데이트를 하는 경우 스레드 부분에서 공부한 바와 같이 핸들러를 사용해야함
	- 가장 간단한 방법으로 post() 메소드 사용 권장, AsyncTask도 가능
<img src="https://user-images.githubusercontent.com/32586985/91122442-519eb700-e6d5-11ea-8b68-55c2145d9f15.PNG">

- 표준 자바의 소켓 클라이언트
<img src="https://user-images.githubusercontent.com/32586985/91122458-5d8a7900-e6d5-11ea-80d7-d9223e5f2f96.PNG">

- 포트를 사용하게 되는데 포트를 사용하게 된다면 숫자가 한정되어 있어서 포트를 사용하고 쓰지 않을 때 중단시켜야 다른 프로그램도 그 포트를 사용할 수 있음
- 기능을 만들기 위해서 서버 기능과 클라이언트 기능을 만들어야함
- 일반적으로 이클립스를 많이 사용함

- 서버와 클라이언트 실습은 따로 만듬
- 안드로이드 매니페스트에서 인터넷 권한을 허용해줘야 함
- 서버에 대해서
<img src="https://user-images.githubusercontent.com/32586985/91122499-74c96680-e6d5-11ea-88de-6fe2d9f7ffb7.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122516-7c890b00-e6d5-11ea-9ca3-8150b1479009.PNG">

- 클라이언트에 대해서
<img src="https://user-images.githubusercontent.com/32586985/91122535-890d6380-e6d5-11ea-84bf-fbc27ea9242e.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122550-91659e80-e6d5-11ea-82ff-37b6e25f6e5d.PNG">

- 방식면에서는 서비스를 백그라운드로 만들어서 그쪽에서 실행을 하는 것이 더 좋은 방식이긴 함

- UI 접근시 핸들러를 써야함
- 어떤 서버던 다른 머신 PC던 요청을 보내서 응답을 받은 다음에 화면에 뿌려준 것을 핸들러를 써서 한 것임, 그리고 스레드 안에서 받은 결과를 화면에 표시한 것
<img src="https://user-images.githubusercontent.com/32586985/91122575-9fb3ba80-e6d5-11ea-8b73-4066f9f807fb.PNG">

- 서버의 코드를 액티비티로 구현을 하였는데 서버를 실행하고 액티비티 스택 안에 들어가서 시스템 리소스가 적으면 시스템이 액티비티를 종료시키는데 이때 서버가 죽어버리는 상황이 생길 수 있음
- 이때 서비스로 구성을 해서 사용할 수 있음
<img src="https://user-images.githubusercontent.com/32586985/91122597-ae9a6d00-e6d5-11ea-9e7e-5c06cbc084fb.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122608-b65a1180-e6d5-11ea-8e55-f6c2ad60f40d.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122622-bd811f80-e6d5-11ea-9553-171627cb8db3.PNG">

- 액티비티는 언제든 종료될 수 있으므로 서비스로 변환해서 쓰는게 훨씬 더 좋은 방법임

- 생각해보기
- 소켓 서버를 이클립스로 만들 때는 어떻게 만들 수 있을까요?
- 이클립스 역시 자바를 사용하므로 위의 실습 예제와 같이 비슷한 방식으로써 스레드를 정의해서 사용할 수 있다
- 소켓을 이용해 데이터를 주고받을 떄는 ObjectInputStream과 ObjectOutputStream만을 사용해야 하나요?
- 직접 메소드를 만들어서 사용할 수도 있다
- 다른 언어로 만들어진 소켓 서버에 연결할 때는 어떤 IO 클래스를 사용해야 할까요?
- 동작원리는 같으므로 클래스가 달라지진 않을 것 같다

## 웹으로 요청하기
### HTTP 이해하기
<img src="https://user-images.githubusercontent.com/32586985/91122692-e3a6bf80-e6d5-11ea-840d-a6519a749d30.PNG">

- 인터넷의 망에 하나가 컴퓨터 머신이 연결되어 있다면 다른 컴퓨터로 접속할 수 있고 소켓은 다른 컴퓨터와 연결을 만드는 과정임, 연결 위에서 데이터가 왔다 갔다 하는 것
- 서버 쪽에는 서버 소켓을 클라이언트 쪽에서는 일반 소켓을 만들어서 클라이언트에서 서버로 연결이 만들어지고 연결은 실제로는 TCP라고 하는 레이어에서 패킷을 주고받으면 저쪽 컴퓨터가 인터넷망에서 어느 위치에 있는지 계속 알아내는 과정이고 계속 알고 있으니 그쪽으로 데이터를 전송하기도 쉬움, 그것이 소켓임

- 웹은 HTTP라는 프로토콜을 씀, 즉 데이터가 왔다 갔다 하는 방법을 HTTP로 쓴다는 것임, 소켓과는 별반 다르지 않음, 소켓을 쓰도록 되어 있으므로 소켓 서버, 소켓으로 클라이언트에 접속하는 구조는 같음
- 다른 점은 소켓은 데이터를 주고 받을 때 임의로 보내어서 테스트를 했지만 웹은 데이터를 주고받는 형식을 소켓 위에서 HTTP라고 하는 정해진 포맷대로 데이터를 보내는 것임
- 위의 그림과 같이 소켓 위에서 HTTP라고 하는 정해진 포맷대로 데이터를 보내는 HTTP Request, HTTP 요청을 하는 것이고 응답을 받을 때도 HTTP Response, HTTP 응답을 하는 것임

<img src="https://user-images.githubusercontent.com/32586985/91122722-fde09d80-e6d5-11ea-8357-cfcbcbff6835.PNG">

- 위와 같은 형태로 소켓 위에 연결해서 데이터를 주고 받음
- Request의 경우 맨 앞의 서버의 어떤 기능을 요청하는지 단어를 쓰고 요청 Path와 요청 파라미터를 주면서 보냄, 보내는 부분을 헤더라고 부름 
- HTTP는 기본적으로 헤더와 바디로 구성됨, 데이터의 설명 부분을 헤더라고 하고 데이터 부분을 바디라고 함, 응답도 마찬가지임
- 헤더 정보도 여러가지 있고 그 중 선택적으로 기록하게 됨
- 소켓 연결 위에서 정해진 포맷으로 데이터를 주고 받고 헤더와 바디로 구성되어 있음

<img src="https://user-images.githubusercontent.com/32586985/91122757-15b82180-e6d6-11ea-80a9-b42fb19ecd7f.PNG">

- 헤더는 여러 줄로 구성되어 있음, 각각의 줄을 엔터로 쳐서 구분을 함, \n,\r 같이
- 헤더와 바디가 구분이 되는 곳은 한 줄 더 떨어져 있음 \r,\n,\r,\n 한 번 더 들어가면 그 밑에 부분을 바디라고 함
- 바디에는 데이터를 그냥 집어넣을수도 있고 JSON이라고 하는 또다른 형식의 포맷으로 데이터를 넣을 수 있음 
- 헤더는 어떤 정보를 넣어줄 수 있고 표준에 딱 정의되어 있음 이렇게 넣으면 이거는 뭘 의미하는지, 이거는 뭘 의미하는지, 이게 요청이 됨 
- 요청 헤더의 첫번째 라인은 위와 같이 구성이 된다고 보면 됨 

<img src="https://user-images.githubusercontent.com/32586985/91122806-31232c80-e6d6-11ea-9be3-4dfae4291e55.PNG">

- 응답 역시 헤더와 바디로 구분이 됨 구성과 방식은 위의 요청과 똑같음

- 개발자 도구를 보면 아래와 같이 서버에 응답과 요청한 것을 확인할 수 있음
<img src="https://user-images.githubusercontent.com/32586985/91122834-426c3900-e6d6-11ea-82f7-30dd20991bf3.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122839-4a2bdd80-e6d6-11ea-8280-69a6f4075ffc.PNG">

- Preview를 누르면 바디부분만 나오게 됨
- 직접 코드를 쓰면 복잡하고 코드를 다 집어넣어야 하므로 보통 라이브러리를 써서 요청을 보내고 응답을 받음, volley를 많이 씀
- HTTP URL 커넥션을 써서 인터넷 연결을 하고 HTTP 요청을 보내고 응답을 받을 수 있음

- 생각해보기
- HTTP의 바디 부분에는 아무렇게나 데이터를 넣어도 되는 걸까요?
- 위의 형식만 맞추었다면 어떠한 데이터를 넣어도 무관함
- HTTP의 바디 부분에 들어가는 데이터의 길이나 데이터의 유형은 어떻게 헤더에 기술할까요?
- Content-type, Content-Length를 통해서 기술할 수 있음

### 웹으로 요청하기
- HTTP 연결 방식
	- 예전 휴대 단말은 데이터 통신의 송수신 속도가 느려서 소켓으로 연결하거나 웹 페이지를 보기 위해서는 많이 기다려야 함
	- 비연결성(stateless)인 HTTP 프로토콜은 새로 연결을 만드는 데 따른 지연 시간이 길게 발생
	- 최근 스마트폰 및 무선 네트워크 환경이 좋아져서 HTTP 프로토콜을 이용한 웹의 사용이 자연스러울 뿐만 아니라 일반 웹 사이트를 보는 풀 브라우징(full browsing)도 가능함
	- 자바에서 사용하던 HTTP 관련 클래스를 그대로 사용할 수 있음

- URL Connection 클래스
- URLConnection 객체
	- API 
	- public URLConnection openConnection()
	- HttpURLConnection 객체로 형변환(casting)하여 사용
- 요청 관련 메소드
	- API
	- public void setRequestMethod(String method)
	- public void setRequestProperty(String field, String newValue)
- 일일이 스레드와 핸들러를 써야 하는 경우가 생김
- 라이브러리를 써서 해결을 할 수도 있긴 함

- 웹으로 요청하기 예제
<img src="https://user-images.githubusercontent.com/32586985/91122935-895a2e80-e6d6-11ea-9a06-8ac98d792180.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122949-92e39680-e6d6-11ea-8273-fd2e5dc84c91.PNG">
<img src="https://user-images.githubusercontent.com/32586985/91122960-9a0aa480-e6d6-11ea-81a0-b42630abf257.PNG">

- 사이트에 있는 데이터를 그대로 받아서 뿌림, 처음 요청하는 데이터만 받아서 표시를 한 것임
- 웹 서버에 접속하고 응답을 받음
- 스레드를 만들어서 요청을 하면서 핸들러를 사용해서 처리를 하고 인터넷 권한을 허용해야함
- 스레드와 핸들러를 사용하지 않고 간단하게 처리하게 할 경우 라이브러리를 사용할 수 있음
- OkHttp와 Volley가 있음

- 생각해보기
- 응답 데이터가 웹페이지인 경우에는 화면에 어떻게 표시할 수 있을까요?
- 웹뷰 위젯으로 처리해서 볼 수 있음
- 응답 데이터가 JSON이라면 화면에 어떻게 표시할 수 있을까요?
- JSON의 데이터를 받아서 처리할 수 있는 라이브러리나 class를 만들어서 처리한 후 표시할 수 있음